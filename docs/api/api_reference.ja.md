# API リファレンス

## API 検索パラメータ

`$data` 引数（PHP API）または URL クエリ文字列（REST API）に検索パラメータを渡すことで、検索をフィルタリングし、その出力を制御できます。

### 共通パラメータ

これらは、ほぼ全ての API リソースに共通する検索パラメータです：

| パラメータ | 説明 | タイプ | デフォルト |
| --- | --- | --- | --- |
| id | 指定された ID または複数の ID に一致するものに絞る。複数の ID は PHP 配列構文(`id[]`)を用いて指定できます。(3.0.0で追加) | 整数または整数の配列 | なし |
| sort_by | このフィールドによって結果セットをソートする | 文字列 | created |
| sort_order | この順序で結果セットをソートする、昇順("asc")または降順("desc") | 文字列 | desc |
| page | 返す結果セットのページ番号 | 整数 | 1 |
| per_page | ページごとの結果数 | 整数 | [グローバル「ページごとの結果数」設定](https://omeka.org/s/docs/user-manual/admin/settings/#general)を使用 |
| limit | 返す結果の数 | 整数 | 0（全て）|
| offset | 返す結果のオフセット数 | 整数 | 0（オフセットなし）|

### RDF リソースに関するパラメータ

これらは、すべての RDF リソース（アイテム、メディア、
アイテム・セット）に共通する検索パラメータです：

| パラメータ | 説明 | タイプ |
| --- | --- | --- |
| fulltext_search | フルテキストインデックスにマッチする RDF リソースを取得する | 文字列 |
| search | 値で完全にマッチする RDF リソースを取得する | 文字列 |
| owner_id | この所有者に属する RDF リソースを取得する | 整数 |
| resource_class_label | このユニークなラベルを持つクラスに属する RDF リソースを取得する | 文字列 |
| resource_class_id | このユニークな識別子を持つクラスに属する RDF リソースを取得する | 整数 |
| resource_template_id | このユニークな識別子を持つテンプレートに属する RDF リソースを取得する | 整数 |
| is_public | 公開または非公開の RDF リソースを取得する | ブール値 |

RDF リソースは、`property` キーと以下のクエリフォーマットを用いた詳細な値検索も特徴としています：

- `property[{index}][joiner]`: 前のクエリとのブール結合子（有効なオプションは `and`、`or`; デフォルトは `and`）
- `property[{index}][property]`: プロパティ ID または用語名（例: `dcterms:title`）
    - ここでプロパティに関係なくすべての値を横断して検索するために、プロパティ ID として `0` も提供できます
- `property[{index}][text]`: 検索テキスト
- `property[{index}][type]`: 検索タイプ
    - eq: 正確に一致する
    - in: 含まれる
    - sw: で始まる
    - ew: で終わる
    - res: 与えられた ID を持つ Omeka S リソースへのリンク
    - ex: どんな値でも持っている（この検索タイプは `text` を渡す必要はありません）
    - 全てのタイプは、「n」という文字を前に付けることで否定が可能です。例えば `neq` は検索テキストと正確に一致する値を持たないリソースを返します。

### アイテムに関するパラメータ

| パラメータ | 説明 | タイプ |
| --- | --- | --- |
| item_set_id | このアイテムセットに割り当てられたアイテムを取得する。指定したセットのいずれかが割り当てられたアイテムを返すために、ID の配列（PHP 形式）を渡す。 | 整数（または整数の配列） |
| site_id | このサイトのアイテムプールにあるアイテムを取得する | 整数 |
| site_attachments_only | site_id 使用時、アイテムがサイトページブロックに添付されている必要があるかどうか | ブール値 |

### メディアに関するパラメータ

| パラメータ | 説明 | タイプ |
| --- | --- | --- |
| item_id | このアイテムに割り当てられたメディアを取得する | 整数 |
| media_type | このメディアタイプのメディアを取得する | 文字列 |
| site_id | このサイトのアイテムプールにあり、ブロックに添付されているメディアを取得する | 整数 |
| ingester | このインジェスターを使用するメディアを取得する (3.0.0で追加) | 文字列 |
| renderer | このレンダラーを使用するメディアを取得する (3.0.0で追加) | 文字列 |

### アイテムセットに関するパラメータ

| パラメータ | 説明 | タイプ |
| --- | --- | --- |
| is_open | 開かれているか閉じているかのアイテムセットを取得する | ブール値 |
| site_id | このサイトのアイテムセットプールにあるアイテムセットを取得する | 整数 |

### ボキャブラリーに関するパラメータ

| パラメータ | 説明 | タイプ |
| --- | --- | --- |
| owner_id | この所有者に属するボキャブラリーを取得する | 整数 |
| namespace_uri | このユニークなネームスペース URI を持つボキャブラリーを取得する（例: "http://purl.org/dc/terms/"） | 文字列 |
| prefix | このユニークなネームスペースプレフィックスを持つボキャブラリーを取得する（例: "dcterms"） | 文字列 |

### リソースクラスに関するパラメータ

| パラメータ | 説明 | タイプ |
| --- | --- | --- |
| owner_id | この所有者に属するクラスを取得する | 整数 |
| vocabulary_id | このユニークな識別子を持つ語彙に属するクラスを取得する | 整数 |
| vocabulary_namespace_uri | このユニークなネームスペース URI を持つ語彙に属するクラスを取得する（例: "http://purl.org/dc/dcmitype/"） | 文字列 |
| vocabulary_prefix | このユニークなネームスペースプレフィックスを持つ語彙に属するクラスを取得する（例: "dcmitype"） | 文字列 |
| local_name | このローカル名を持つクラスを取得する（例: "Image"） | 文字列 |
| term | このユニークな用語を持つクラスを取得する（例: "dcmitype:Image"） | 文字列 |
| used | 少なくとも1つのリソースによって使用されているクラスのみを取得する (3.0.0で追加) | ブール値 |

### プロパティに関するパラメータ

| パラメータ | 説明 | タイプ |
| --- | --- | --- |
| owner_id | この所有者に属するプロパティを取得する | 整数 |
| vocabulary_id | このユニークな識別子を持つ語彙に属するプロパティを取得する | 整数 |
| vocabulary_namespace_uri | このユニークなネームスペース URI を持つ語彙に属するプロパティを取得する（例: "http://purl.org/dc/terms/"） | 文字列 |
| vocabulary_prefix | このユニークなネームスペースプレフィックスを持つ語彙に属するプロパティを取得する（例: "dcterms"） | 文字列 |
| local_name | このローカル名を持つプロパティを取得する（例: "title"） | 文字列 |
| term | このユニークな用語を持つプロパティを取得する（例: "dcterms:title"） | 文字列 |
| used | 少なくとも1つのリソースによって使用されているプロパティのみを取得する (3.0.0で追加) | ブール値 |

### ユーザーに関するパラメータ

| パラメータ | 説明 | タイプ |
| --- | --- | --- |
| email | このユニークなメールを持つユーザーを取得する | 文字列 |
| name | この名前を持つユーザーを取得する | 文字列 |
| role | この役割を持つユーザーを取得する（選択肢は: global_admin, site_admin, editor, reviewer, author, researcher） | 文字列 |
| is_active | アクティブまたは非アクティブなユーザーを取得する | ブール値 |
| site_permission_site_id | サイト権限を持つユーザーを取得する | 整数 |

## API リクエストオプション

ほとんどのリソースについて、`$options` 引数でリクエストの実行に影響を与えるオプションを渡すことができます。これらのオプションは PHP API でのみ利用でき、REST API では利用できません。

| オプション | タイプ | 説明 | デフォルト |
| --- | --- | --- | --- |
| initialize | ブール値 | execute() 実行中にリクエストを初期化するかどうかを設定します（例: API-pre イベントをトリガーする）。 | `true` |
| finalize | ブール値 | execute() 実行中にリクエストを最終処理するかどうかを設定します（例: API-post イベントをトリガーし、"responseContent" オプションに応じてレスポンスコンテンツを変換する）。 | `true` |
| returnScalar | 文字列 | SEARCH リクエスト中にスカラーの配列として返すべきフィールド/カラムを設定します。このオプションが設定されているとき、リクエストは最終処理されません。 | `false` |
| isPartial | ブール値 | これが部分的な UPDATE リクエスト（いわゆる PATCH）であるかどうかを設定します。 | `false` |
| collectionAction | 文字列 | 部分的な UPDATE リクエスト中に特定のコレクションで取るべきアクションを設定します：<ul><li>`"replace"`: 伝えられたデータでコレクションを置き換える</li><li>`"append"`: コレクションに伝えられたデータを追加する</li><li>`"remove"`: コレクションから伝えられたデータを削除する</li></ul> | `"replace"` |
| continueOnError | ブール値 | BATCH_CREATE 操作がエラーが発生しても処理を続けるべきかどうかを設定します。 | `false` |
| flushEntityManager | ブール値 | CREATE、UPDATE、DELETE の間にエンティティマネージャーをフラッシュするかどうかを設定します。 | `true` |
| responseContent | 文字列 | API レスポンスが含むべきコンテンツのタイプを設定します。デフォルトは "representation" です。タイプは以下の通りです：<ul><li>`"representation"`: API リソース表現</li><li>`"reference"`: API リソース参照</li><li>`"resource"`: API リソース</li></ul> | `"representation"` |