# 設定可能なリソースページブロック

Omeka Sには、アイテム、アイテムセット、メディアの表示ページ用の設定可能なブロックなど、エキサイティングな新機能が搭載されています。この機能により、サイトの作成者はこれらの表示ページにさまざまなタイプのコンテンツを含めたり、配置したりすることができます。この設定可能なコンテンツで、ブロックとして編成されたものには、リソースの値、アイテムセット、リンクされたリソース、関連するメディアを表示する様々な方法が含まれています。

## テーマにリソースページブロック構成を追加する

### テーマ設定での領域の定義

`theme.ini`ファイルから始めます。そこでは、設定可能な領域およびそれらがサポートするブロックを定義する必要があります。

アイテム、アイテムセット、メディア用の領域を作成できます。`resource_page_regions`をリソースページの領域として特定した後、それぞれの領域に名前をつけます。これはアイテム表示ビュー用の「メイン」という領域を作成する例です。
text
resource_page_regions.items.main = "メイン"

最初は必ず`resource_page_regions`から始めます。次の部分では領域がアイテム表示ページに表示されることを表しています。最後のパラメーターは、領域につける名前で、割り当てられた値は管理インターフェースに表示される領域のわかりやすい名前です。

領域を作成した後、その領域にデフォルトで含まれるブロックを定義する必要があります。**リソースページの構成機能は、領域とその領域用のデフォルトブロックが定義された後にのみ表示されます。** 以下は、Omeka Sが構成用に提供するすべてのブロックのリストと、それらをサポートするリソースページです。

**ブロック**|**短い名前**|**アイテム**|**メディア**|**アイテムセット**
:-----:|:-----:|:-----:|:-----:|:-----:
値|values|✅|✅|✅
サイトページ|sitePages|✅|✅|✅
リンクされたリソース|linkedResources|✅|✅|✅
リソースクラス|resourceClass|✅|✅|✅
メディア埋め込み|mediaEmbeds|✅|✅| 
LightGalleryメディアビューア|lightGallery|✅|✅| 
アイテムセット|itemSets|✅| | 
メディアリスト|mediaList|✅| | 

リソースページには通常そのメタデータ値が含まれるため、そのブロックをデフォルトで含めるのが良い候補です。次の例では、アイテムページのメイン領域のデフォルトブロックとして値ブロックを定義しています。
text
resource_page_blocks.items.main[] = "values"

前の例`resource_blocks.items.main`からほとんど同じ内容を取り、その領域のブロックの配列にショートネームがブロックのものを設定して配列に加えます。表は値のショートネームが単に`values`であることを示しています。これを領域のデフォルトにしたいブロックに対してそれぞれ行います。

この行を`theme.ini`に含めた後、Omeka Sインターフェースでリソースページの構成にアクセスできるようになります。サイト管理エリアに移動し、「テーマ」を選択します。テーマが有効であることを確認してください。有効になると、「リソースページを構成する」というボタンがテーマの説明の下に表示されます。

![Omeka S管理エリア内のサイトテーマビューからのスクリーンショット。"現在のテーマ: デフォルト, バージョン 1.7.0"と表示され、テーマ作者の"Omeka Team"がリンクとして表示されています。2つのボタンがあります："テーマ設定を編集"と "リソースページを構成する"](../img/resource_page_blocks-1.jpg)

クリックすると以下のようなインターフェイスが表示されます。

![Omeka S管理エリア内のサイトテーマビューからのスクリーンショット。リソースページの設定可能なブロックが強調表示されています。上部バーにはラップトップのアイコンと"THEME"(テーマ)のラベルがあります。ページタイトルは"デフォルト - リソースページを構成する"と読まれます。右側には"Canel"(キャンセル)と"Save"(保存)のボタンがあります。メインコンテンツエリアには3つのタブがあり、それぞれのリソースタイプの表示ページ："アイテムページ"、"メディアページ"、"アイテムセットページ"です。"アイテムページ"が現在の選択です。タブの下には "領域：メイン" という見出しがあります。見出しの下には、"値"というグレーの塗りの行があるグレーの枠線の長方形があります。行の左側には、行がドラッグ可能であることを示す3つの水平バーのアイコンがあります。行の右端には、行を削除できることを示すゴミ箱アイコンがあります。タブの右側とその領域インターフェイスには、サイドバーがあります。"領域を選択する"という見出しの下には、現在"メイン"オプションがアクティブになっている選択ドロップダウンが続きます。その下には、"選択した領域にブロックを追加する"という見出しがあります。そして、ライトグレーのプラスアイコンが右側にある"アイテムセット"というラベルのボタンが続きます。](../img/resource_page_blocks-2.jpg)

アイテム表示ビューでアイテムセット、リンクされたリソース、メディアリストを自動的に表示させたい場合、次の例のようになります。
text
resource_page_blocks.items.main[] = "itemSets"
resource_page_blocks.items.main[] = "linkedResources"
resource_page_blocks.items.main[] = "mediaList"

すべてのリソースタイプでブロックを利用可能にしたい場合は、各リソースビューに対してそれを定義する必要があります。たとえば、各タイプのリソース値を構成可能にしたいと思うかもしれません。各リソースタイプが値ブロックを自動的に表示するようにする3行が必要です。
text
resouce_page_blocks.items.main[] = "values"
resouce_page_blocks.item_sets.main[] = "values"
resouce_page_blocks.menu.main[] = "values"

### 表示ページでのデフォルトコンテンツ

以下は、設定可能なブロック機能が導入される前のアイテム表示ページに表示されたデフォルトコンテンツリストです：

**ブロック**|**短い名前**
:-----:|:-----:
値|values
アイテムセット|itemSets
サイトページ|sitePages
リンクされたリソース|linkedResources
メディアリスト|mediaList

アイテムセットとメディアの表示ページは、デフォルトでリソースの値のみを表示しました。

## ビューでのページブロックの表示

### デフォルトビューの出力

テーマがOmeka Sのデフォルトビューに依存している場合、設定されたページブロックが表示される単一のメイン領域がテーマに自動的に含まれます。デフォルトビューには、以下のような行が含まれており、ブロックを表示します。この例はアイテムの表示ページから抜粋したもので、`$item`を渡します。
php-template
<?php echo $this->resourcePageBlocks($item)->getBlocks(); ?>

### 複数の領域をサポートするカスタムビュー

複数の領域がブロックを表示できるようにするためには、テーマ内に表示ページのカスタムバージョンを持つ必要があります。また、`theme.ini`で複数の領域を定義する必要もあります。以下の例では、テーマはアイテムの表示ページで「メイン」と「右サイドバー」という2つのコンテンツ領域をサポートしています。
text
resource_page_regions.items.main = "メイン"
resource_page_regions.items.right = "右サイドバー"

これら2つの領域は、ブロックを追加するためのリソースページブロック構成インターフェイスに表示されるはずです。

![Omeka S管理エリア内のサイトテーマビューからのスクリーンショット。メインコンテンツエリアが表示され、上部に3つのリソースタイプページタブがあります。領域「領域：メイン」および「領域：右サイドバー」が表示されています。「領域：メイン」には、「値」、「アイテムセット」、「サイトページ」、「リンクされたリソース」、「メディア埋め込み」の5つの並べ替えおよび削除可能な行があります。「領域：右サイドバー」は空です。インターフェイスの右サイドバーには、「選択する領域」という見出しがあります。その下の選択項目は開かれ、「メイン」と「右サイドバー」というオプションを露出しています。「メイン」がハイライト表示されています。見出しの下には、4つのラベルと右側に「プラス」アイコンが付いたボタンが続いています：「ライトボックスギャラリー」、「メディアリスト」、「リソースクラス」、「マッピング」](../img/resource_page_blocks-3.jpg)

これらの設定された領域を出力するために、テーマは`show.phtml`内でこれらのブロックが現れる場所を定義する必要があります。`theme.ini`からの領域のショートネームを`resourcePageBlocks()`に渡すことによって、各領域のブロックが呼び出されます。2つの領域は`show.phtml`内で以下のように見えるかもしれません。
php-template
<div class="main-content">
    <?php echo $this->resourcePageBlocks($item, 'main')->getBlocks(); ?>
</div>

<?php if ($this->resourcePageBlocks($item, 'right')->hasBlocks()): ?>
<div class="sidebar">
    <?php echo $this->resourcePageBlocks($item, 'right')->getBlocks(); ?>
</div>
<?php endif; ?>

## 既存のカスタム表示ページをリソースページブロックを使用するように更新する

テーマのカスタム表示ページを更新する例を見てみましょう。このケースでは、Papersを検討します。こちらが設定可能なリソースページブロックの前のアイテムの表示ページのスクリーンショットです。

![Omeka Sサイトで「Papers」テーマを使用しているスクリーンショット。テクスチャ入りのグレーの背景画像を使用しています。これは「モールに到着したアロサウルス」というアイテムの表示ページの一部で、「国立自然史博物館」の前にあるアロサウルスの白黒写真を特集しています。その下には、タイトル、説明、ソース、日付、対象、および範囲のメタデータ値があります。それらの値の下には、このアイテムが属するアイテムセットが表示されているフィールドがあります。](../img/resource_page_blocks-4.jpg)

これは、Papersのカスタムアイテム表示ページでのコンテンツがどのように見えるかです。アイテムタイトル、メディア埋め込みオプション、リソース値、アイテムセット、メディアリストオプション、リンクされたリソースを明示的に順序立てて設定しています。これらのコンテンツタイプは単一列レイアウトで表示されます。
php-template
…

<?php echo $this->pageTitle($item->displayTitle(), 2); ?>
<h3><?php echo $translate('アイテム'); ?></h3>
<?php $this->trigger('view.show.before'); ?>
<?php if ($embedMedia && $itemMedia): ?>
    <div class="media-embeds">
    <?php foreach ($itemMedia as $media):
        echo $media->render();
    endforeach;
    ?>
    </div>
<?php endif; ?>
<div class="properties">
<?php echo $item->displayValues(); ?>
<?php $itemSets = $item->itemSets(); ?>
<?php if (count($itemSets) > 0): ?>
<div class="property">
    <?php if (count($itemSets) > 0): ?>
    <h4><?php echo $translate('アイテムセット'); ?></h4>
    <div class="values">
        <?php foreach ($itemSets as $itemSet): ?>
        <div class="value"><a href="<?php echo $escape($itemSet->url()); ?>"><?php echo $itemSet->displayTitle(); ?></a></div>
        <?php endforeach; ?>
    </div>
    <?php endif; ?>
</